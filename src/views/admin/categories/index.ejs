<div class="layout-wrapper">

  <!-- Header -->
  <div class="header d-flex justify-content-between align-items-center">
    <div class="menu-toggle-btn">
      <a href="#">
        <i class="bi bi-list" style="color: #DBB778; margin-left:10px;"></i>
      </a>
    </div>

    <div class="header-title">
      <span>Manage Categories</span>
    </div>

    <a href="/" class="logo">
      <img src="/assets/User/logo/Logo-min.png" height="40" id="logo" alt="logo">
    </a>

    <div class="header-mobile-buttons d-flex align-items-center">
      <a href="#" class="search-bar-btn"></a>
      <a href="#" class="actions-btn">
        <i class="bi bi-three-dots"></i>
      </a>

      <!-- Profile dropdown -->
  
      <!-- ./ Profile dropdown -->
    </div>
  </div>

  <!-- Content -->
  <div class="content">

    <!-- Breadcrumb -->
    <div class="mb-4">
      <nav style="--bs-breadcrumb-divider: '>';" aria-label="breadcrumb">
        <ol class="breadcrumb">
          <li class="breadcrumb-item">
            <a href="/dashboard">
              <i class="bi bi-globe2 small me-2"></i> Dashboard
            </a>
          </li>
          <li class="breadcrumb-item active" aria-current="page">Categories</li>
        </ol>
      </nav>

      <!-- Add button -->
      <div>
        <a href="/categories/create">
          <button class="btn btn-primary">Add Category</button>
        </a>
      </div>

      <br>

      <% if (typeof success !== 'undefined' && success.length > 0) { %>
        <div class="alert alert-success">
          <%= success %>
        </div>
      <% } %>

      <% if (typeof error !== 'undefined' && error.length > 0) { %>
        <div class="alert alert-danger">
          <%= error %>
        </div>
      <% } %>

    </div>

    <!-- Card: Filters and Table -->
    <div class="card">
      <div class="card-body">

        <div class="d-md-flex gap-4 align-items-center">
          <div class="d-none d-md-flex text-dark">All Categories</div>

          <div class="d-md-flex gap-4 align-items-center">
            <form class="mb-3 mb-md-0" id="filterForm">
              <div class="row g-3">
                <div class="col-md-3">
                  <select class="form-select" name="sortDirection" id="sortSelect">
                    <option value="">Sort by</option>
                    <option value="desc">Desc</option>
                    <option value="asc">Asc</option>
                  </select>
                </div>
                <div class="col-md-3">
                  <select class="form-select" id="perPageSelect">
                    <option value="10">10</option>
                    <option value="20">20</option>
                    <option value="30">30</option>
                    <option value="40">40</option>
                    <option value="50">50</option>
                  </select>
                </div>
                <div class="col-md-6">
                  <div class="input-group">
                    <input type="text" class="form-control" placeholder="Search" id="searchInput">
                    <button class="btn btn-outline-light" type="button" id="searchButton"></button>
                  </div>
                </div>
              </div>
            </form>
          </div>

        </div>
      </div>
    </div>

    <!-- Table -->
    <div class="table-responsive">
      <table class="table table-custom table-lg mb-0" id="featuresTable">
        <thead>
          <tr>
            <th>ID</th>
            <th>CATEGORY NAME</th>
            <th class="text-end">Actions</th>
          </tr>
        </thead>

        <tbody>
          <% if (categories && categories.length > 0) { %>
            <% categories.forEach(category => { %>
              <tr>
                <td><%= category.id %></td>
                <td><%= category.name %></td>
                <td class="text-end">
                  <div class="d-flex">
                    <div class="dropdown ms-auto">
                      <a href="#" data-bs-toggle="dropdown" class="btn btn-floating" aria-haspopup="true" aria-expanded="false">
                        <i class="bi bi-three-dots"></i>
                      </a>
                      <div class="dropdown-menu dropdown-menu-end">
                        <a href="/categories/<%= category.id %>/edit" class="dropdown-item">Edit</a>
                        <form action="/categories/delete/<%= category.id %>" method="POST" style="display:inline;">
                          <button type="submit" class="dropdown-item text-danger">Delete</button>
                        </form>
                      </div>
                    </div>
                  </div>
                </td>
              </tr>
            <% }) %>
          <% } else { %>
            <tr>
              <td colspan="3" class="text-center text-muted">No categories found.</td>
            </tr>
          <% } %>
        </tbody>
      </table>
    </div>

    <footer>
      <p class="text-center my-2">&copy; 2025 Opti-Reserve</p>
    </footer>
    <br>
  </div>
</div>

<script>
  // Delete confirmation
  document.querySelectorAll('form[action*="/delete"]').forEach(form => {
    form.addEventListener('submit', e => {
      e.preventDefault();
      Swal.fire({
        title: 'Are you sure you want to delete this category?',
        icon: 'warning',
        showCancelButton: true,
        confirmButtonColor: '#3085d6',
        cancelButtonColor: '#d33',
        confirmButtonText: 'Yes, delete it!'
      }).then(result => {
        if (result.isConfirmed) form.submit();
      });
    });
  });
</script>
